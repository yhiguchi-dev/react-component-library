<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>ユーザー登録</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
      integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <nav class="navbar navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="https://www.solxyz.co.jp/">
          <img src="http://localhost:8080/logo.svg" alt="solxyz-logo" />
        </a>
      </div>
    </nav>
    <div class="container" style="width: 18rem">
      <h3>新規登録</h3>
      <form
        th:action="@{/home}"
        th:object="${registrationRequest}"
        method="post"
        novalidate
      >
        <div class="form-floating">
          <input
            type="email"
            class="form-control"
            id="email"
            placeholder="name@example.com"
            th:field="*{email}"
            required
          />
          <label for="email" class="form-label" style="color: lightgray"
            >メールアドレス</label
          >
          <div id="emailErrorMessage" class="form-text" style="color: red" />
        </div>
        <div class="form-floating">
          <input
            type="password"
            class="form-control"
            id="password"
            placeholder="Password"
            th:field="*{password}"
            required
            pattern="^[a-zA-Z\d]{8,100}$"
          />
          <label for="password" class="form-label" style="color: lightgray"
            >パスワード</label
          >
          <div id="passwordErrorMessage" class="form-text" style="color: red" />
        </div>
        <div class="form-floating">
          <input
            type="password"
            class="form-control"
            id="passwordConfirmation"
            placeholder="Password"
            required
          />
          <label for="password" class="form-label" style="color: lightgray"
            >パスワード確認</label
          >
          <div
            id="passwordConfirmationErrorMessage"
            class="form-text"
            style="color: red"
          />
        </div>
        <div class="mb-3">
          <input
            class="form-check-input"
            type="checkbox"
            onclick="passwordHideOrShow()"
            id="passwordCheckbox"
          />
          <label class="form-check-label" for="passwordCheckbox">
            パスワード表示
          </label>
        </div>
        <button type="submit" class="btn btn-primary">新規登録</button>
      </form>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script th:inline="javascript">
      (() => {
        const email = document.getElementById("email");
        const password = document.getElementById("password");
        const passwordConfirmation = document.getElementById(
          "passwordConfirmation"
        );
        const form = document.querySelector("form");
        const emailErrorMessage = document.getElementById("emailErrorMessage");
        const passwordErrorMessage = document.getElementById(
          "passwordErrorMessage"
        );
        const passwordConfirmationErrorMessage = document.getElementById(
          "passwordConfirmationErrorMessage"
        );

        email.addEventListener("input", () => {
          if (email.validity.valid) {
            emailErrorMessage.value = "";
          } else {
            emailErrorMessage.value = "入力内容に誤りがあります";
          }
        });

        password.addEventListener("input", () => {
          if (password.validity.valid) {
            passwordErrorMessage.value = "";
          } else {
            passwordErrorMessage.value = "入力内容に誤りがあります";
          }
        });

        passwordConfirmation.addEventListener("input", () => {
          console.log(password.value);
          if (password.value === passwordConfirmation.value) {
            passwordConfirmationErrorMessage.value = "";
          } else {
            passwordConfirmationErrorMessage.value =
              "パスワードの入力内容と異なっています";
          }
        });

        form.addEventListener("submit", (event) => {
          if (
            !(
              email.validity.valid &&
              password.validity.valid &&
              passwordConfirmation.validity.valid
            )
          ) {
            event.preventDefault();
          }
        });
      })();
    </script>
    <script th:inline="javascript">
      const passwordHideOrShow = () => {
        const password = document.getElementById("password");
        const passwordConfirmation = document.getElementById(
          "passwordConfirmation"
        );
        if (password.type === "password") {
          password.type = "text";
          passwordConfirmation.type = "text";
        } else {
          password.type = "password";
          passwordConfirmation.type = "password";
        }
      };
    </script>
  </body>
</html>
